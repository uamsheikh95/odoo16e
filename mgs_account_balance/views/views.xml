<odoo>
    <!-- Accout Payment -->
    <record id="account_balance_payment_from_inherit" model="ir.ui.view">
        <field name="name">account.payment.form.inherit</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="replace">

                <label for="partner_id" string="Partner" attrs="{'invisible': [('payment_type', 'not in', ('inbound', 'outbound'))]}" />
                <div class="address_format" style="position:relative">
                    <field name="partner_id" style="width: 75%" options="{'no_create': True}" context="{'default_is_company': True}" string="Customer" attrs="{'readonly':[('state', '!=', 'draft')], 'invisible':['|', ('partner_type','!=','customer'), ('is_internal_transfer', '=', True)]}"/>
                    <field name="partner_balance" style="position: absolute; right: 0;" attrs="{'invisible':['|', ('partner_type','!=','customer'), ('is_internal_transfer', '=', True)]}"/>
                </div>
            </xpath>

            <xpath expr="//field[@name='journal_id']" position="replace">
                <label for="journal_id" string="Payment Journal" />
                <div class="address_format" style="position:relative">
                    <field name="journal_id" style="width: 75%" domain="[('type', 'in', ('bank', 'cash'))]" attrs="{'readonly': [('state', '!=', 'draft')], 'invisible': [('journal_id', '=', False)]}"/>
                    <field name="account_balance" style="position: absolute; right: 0;" />
                </div>
            </xpath>

            <xpath expr="//field[@name='destination_journal_id']" position="replace">
                <label for="destination_journal_id" string="Payment Journal"/>
                <div class="address_format" style="position:relative">
                    <field name="destination_journal_id" style="width: 75%" context="{'default_partner_id': partner_id}" attrs="{'invisible': [('is_internal_transfer', '=', False)], 'readonly': [('state', '!=', 'draft')], 'required': [('is_internal_transfer', '=', True),('state', '=', 'draft')]}"/>
                    <field name="tranfer_account_balance" attrs="{'invisible': [('is_internal_transfer', '=', False)], 'required': [('is_internal_transfer', '=', True),('state', '=', 'draft')]}" style="position: absolute; right: 0;"/>
                </div>
            </xpath>
        </field>
    </record>

    <record id="account_balance_payment_register_from_inherit" model="ir.ui.view">
        <field name="name">account.payment.register.form.inherit</field>
        <field name="model">account.payment.register</field>
        <field name="inherit_id" ref="account.view_account_payment_register_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='journal_id']" position="replace">
                <label for="journal_id" string="Payment Journal" />
                <div class="address_format" style="position:relative">
                    <field name="journal_id" style="width: 75%" options="{'no_open': True, 'no_create': True}" required="1"/>
                    <field name="account_balance" style="position: absolute; right: 0;" />
                </div>
            </xpath>
        </field>
    </record>

    <!-- Accout Move -->
    <record id="account_balance_move_from_inherit" model="ir.ui.view">
        <field name="name">account.move.form.inherit</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="replace">
                <div class="address_format" style="position:relative">
                    <field name="partner_id" style="width: 75%" widget="res_partner_many2one" nolabel="1" 
                        context="{'res_partner_search_mode': (context.get('default_move_type', 'entry') in ('out_invoice', 'out_refund', 'out_receipt') and 'customer') or (context.get('default_move_type', 'entry') in ('in_invoice', 'in_refund', 'in_receipt') and 'supplier') or False, 'show_address': 1, 'default_is_company': True, 'show_vat': True}" 
                        options="{&quot;always_reload&quot;: True, &quot;no_quick_create&quot;: True}" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>
                    <field name="partner_balance" nolabel="1" style="position: absolute; right: 0;width: 25%; text-align: right;" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>
                </div>
            </xpath>
        </field>
    </record>

     <!-- Sale Order -->
    <record id="account_balance_sale_order_from_inherit" model="ir.ui.view">
        <field name="name">sale.order.form.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="replace">
                 <label for="partner_id"/>
                <div class="address_format" style="position:relative">
                    <field name="partner_id" style="width: 75%" widget="res_partner_many2one" 
                        context="{'res_partner_search_mode': 'customer', 'show_address': 1, 'show_vat': True}" options="{&quot;always_reload&quot;: True, 'no_create': True}"/>
                    <field name="partner_balance" style="position: absolute; right: 0;"/>
                </div>
            </xpath>
        </field>
    </record>

     <!-- Purchase Order -->
    <record id="account_balance_purchase_order_from_inherit" model="ir.ui.view">
        <field name="name">purchase.order.form.inherit</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="replace">
            <label for="partner_id"/>
                <div class="address_format" style="position:relative">
                    <field name="partner_id" style="width: 75%" widget="res_partner_many2one" 
                        context="{'res_partner_search_mode': 'supplier', 'show_vat': True}" placeholder="Name, TIN, Email, or Reference"/>
                    <field name="partner_balance" style="position: absolute; right: 0;"/>
                </div>
            </xpath>
        </field>
    </record>

    <!-- Invocie -->
    <template id="add_partner_balance_to_invoice" inherit_id="account.document_tax_totals">
        <xpath expr="//tr[@class='border-black o_total']" position="after">
            <tr class="border-black o_total">
                <td><strong>Previous Balance</strong></td>
                <td class="text-right">
                    <span t-field="o.currency_id.symbol" /> <span t-esc="'{0:,.2f}'.format(o.partner_id.credit-o.amount_total)"/>
                </td>
            </tr>

        
            <tr class="border-black o_total">
                <td><strong>Current Balance</strong></td>
                <td class="text-right">
                    <span t-field="o.currency_id.symbol" /> <span t-esc="'{0:,.2f}'.format(o.partner_id.credit)"/>
                </td>
            </tr>
        </xpath>
    </template>
</odoo>
