<odoo>
    <data noupdate="1">
        <record id="sequence_fo_seq" model="ir.sequence">
            <field name="name">Fleet Service Order Sequence</field>
            <field name="code">fleet.vehicle.log.services</field>
            <field name="prefix">FS</field>
            <field eval="1" name="number_next"/>
            <field eval="1" name="number_increment"/>
            <field eval="False" name="company_id"/>
            <field name="padding">4</field>
        </record>
    </data>

    <record id="paperformat_fleet_addons" model="report.paperformat">
        <field name="name">Custom Fleet A5 Reports</field>
        <field name="default" eval="True"/>
        <field name="format">A5</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">33</field>
        <field name="margin_bottom">7</field>
        <field name="margin_left">7</field>
        <field name="margin_right">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">25</field>
        <field name="dpi">90</field>
    </record>

    <record id="vehicle_custom" model="ir.ui.view">
        <field name="name">fleet.vehicle.form</field>
        <field name="model">fleet.vehicle</field>
        <field name="inherit_id" ref="fleet.fleet_vehicle_view_form" />
        <field name="type">form</field>
        <field name="arch" type="xml">

            <!-- <xpath expr="//field[@name='date']" position="after">
        </xpath> -->

        <xpath expr="//field[@name='next_assignation_date']" position="after">
            <field name="fuel_type"  />
            <field name="limit_fuel"  />
            <field name="consumed_fuel"  />
        </xpath>

    </field>
</record>

<record id="fleet_fuel" model="ir.ui.view">
    <field name="name">fleet.vehicle.log.services.form</field>
    <field name="model">fleet.vehicle.log.services</field>
    <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_view_form" />
    <field name="type">form</field>
    <field name="arch" type="xml">

        <xpath expr="//group" position="before">
            <div class="oe_title" style="float:left;width:50%;margin-top:20px">
                <h1>
                    <field name="seq" readonly="1" />
                </h1>
            </div>
        </xpath>

        <xpath expr="//field[@name='date']" position="after">
            <field name='limit_fuel' attrs="{'invisible':[('is_feul','=',False)]}"/>
            <field name='consumed_fuel' attrs="{'invisible':[('is_feul','=',False)]}"/>
            <field name='is_feul' invisible="1"/>
            <field name='liter' attrs="{'invisible':[('is_feul','=',False)]}"/>
            <field name='per_liter' attrs="{'invisible':[('is_feul','=',False)]}"/>
        </xpath>

        <!-- <xpath expr="//field[@name='liter']" position="before">
        <field name="fuel_type"  />
    </xpath> -->

</field>
</record>

<record id="fleet_service" model="ir.ui.view">
    <field name="name">fleet.vehicle.log.services.form</field>
    <field name="model">fleet.vehicle.log.services</field>
    <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_view_form" />
    <field name="type">form</field>
    <field name="arch" type="xml">



        <xpath expr="//field[@name='notes']" position="before">
            <field name="item_ids" readonly="0" attrs="{'invisible':[('is_feul','=',True)]}" nolabel="1" context="{'default_fleet_service_id':id}">
                <tree editable="bottom">
                    <field name = "name" string="Item" />
                    <field name = "qty" sum="qty"/>
                    <field name = "fleet_service_id" invisible="1"/>
                </tree>
            </field>
        </xpath>
    </field>
</record>

<record id="vehicle_statement_form" model="ir.ui.view">
    <field name="name">mgs_fleet_addons.vehicle_statement_wiz.form</field>
    <field name="model">mgs_fleet_addons.vehicle_statement_wiz</field>
    <field name="arch" type="xml">
        <form>
            <sheet>
                <group>
                    <group>
                        <field name="date_from" />
                        <field name="vehicle_id" required="1"  string="Vehicle" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True}" />
                    </group>
                    <group>
                        <field name="date_to" />
                    </group>
                </group>
            </sheet>

            <footer>
                <button name="check_report" string="View" type="object" class="oe_highlight"/>
                <button string="Cancel" special="cancel"/>
            </footer>

        </form>
    </field>
</record>

<record id="action_vehicle_statement" model="ir.actions.act_window">
    <field name="name">Print Vehicle Statement</field>
    <field name="res_model">mgs_fleet_addons.vehicle_statement_wiz</field>
    <field name="type">ir.actions.act_window</field>
    <field name="view_mode">form</field>
    <field name="view_id" ref="vehicle_statement_form"/>
    <field name="target">new</field>
</record>


<menuitem id="menu_vehicle_statement_wiz" name="Vehicle Statement"
    parent="fleet.menu_fleet_reporting"
    action="action_vehicle_statement" sequence="1" />

    <report
        id="action_fuel_order_report"
        name="mgs_fleet_addons.log_fuel_report"
        file="mgs_fleet_addons.log_fuel_report"
        model="fleet.vehicle.log.services"
        string="Fuel Order"
        report_type="qweb-html"
        paperformat="paperformat_fleet_addons"
        />

        <template id="log_fuel_report">
                    <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <div class="text-center" style="font-weight:bold;font-size:24px;">Fuel Order #<span class="m-0" t-esc="doc.seq"/></div>
                            
                            <br/>
                            <div class="row mt2 mb2">
                              <div class="col-12" style="background-color:#D5D8DC">
                              <strong>Vendor Details</strong>
                              </div>
                            </div>                            
                            <div class="row" id="informations" >
                                <div class="col-12">
                                  <strong>To:</strong>
                                <span class="m-0" t-esc="doc.vendor_id.name"/><br/>
                                   <span t-if="doc.is_feul"> Fadlan Waxaad ugu shubtaa Shidaal dhan: <span t-field="doc.liter" t-options='{"widget": "float", "precision": 0}'/>Liters,  
                                   adiga oo  hubinaya Macluumaadka Gaadhiga iyo deriver-ka!</span>
                                </div>
                            </div>
                            
                            <div class="row">
                              <div class="col-12" style="background-color:#D5D8DC">
                              <strong>Car Details</strong>
                              </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-3">
                                  <strong>Date:</strong><br/>
                                  <strong>Vehicle:</strong> <br/>
                                  <strong>Plate No:</strong> <br/>
                                  <!-- <strong>Odometer:</strong> <br/> -->
                                  <strong>Driver:</strong>
                                </div>
                                <div class="col-9">
                                  <span class="m-0" t-esc="doc.date"/><br/>
                                  <span class="m-0" t-esc="doc.vehicle_id.name"/><br/>
                                  <span class="m-0" t-esc="doc.vehicle_id.license_plate"/><br/>
                                  <!-- <span class="m-0" t-esc="doc.vehicle_id.odometer" t-options='{"widget": "float", "precision": 0}'/>Km<br/> -->
                                  <span class="m-0" t-esc="doc.vehicle_id.driver_id.name"/>
                                </div>
                              </div>  

                            <table style="margin-top: 10px; width: 100%;font-weight:bold">
                                <thead>
                                    <tr style="height: 32px;background-color:#D5D8DC">
                                        <th style="padding-left: 10px;">Description</th>
                                        <th>Qty</th>
                                        <th>Unit</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="height: 32px">
                                        <td style="padding-left: 10px;"><span t-field="doc.vehicle_id.fuel_type"/></td>
                                        <td><span t-field="doc.liter" t-options='{"widget": "float", "precision": 0}'/></td>
                                        <td>Liters</td>
                                    </tr>
                            </tbody>
                        </table>

                        <div id="informations" class="row mt2 mb2" style="margin-top: 80px">
                              <div class="col-6">
                                <strong>Printed by:</strong><span class="m-0" t-esc="user.name"/>
                              </div>
                              <div class="col-6">
                                <strong>Authorized by:</strong>______________
                              </div>                              
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <report
        id="action_service_order_report"
        name="mgs_fleet_addons.log_services_report"
        file="mgs_fleet_addons.log_services_report"
        model="fleet.vehicle.log.services"
        string="Service Order"
        report_type="qweb-html"
        paperformat="paperformat_fleet_addons"
        />

        <template id="log_services_report">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <h2 class="text-center">Service Order</h2>

                            <div id="informations" class="row mt2 mb2">

                                <div class="col-auto mw-100 mb-2" t-if="doc.date" style="width: 20%; float: left;">
                                    <strong>Date:</strong>
                                    <p class="m-0" t-esc="doc.date"/>
                                </div>
                                <div class="col-auto mw-100 mb-2" t-if="doc.vendor_id.name" style="width: 20%; float: left;">
                                    <strong>Vendor:</strong>
                                    <p class="m-0" t-esc="doc.vendor_id.name"/>
                                </div>


                                <div class="col-auto mw-100 mb-2" t-if="doc.vehicle_id.license_plate" name="due_date" style="width: 20%; float: left;">
                                    <strong>Plate No.:</strong>
                                    <p class="m-0" t-esc="doc.vehicle_id.license_plate"/>
                                </div>

                                <div class="col-auto mw-100 mb-2" t-if="doc.vehicle_id.driver_id" style="width: 20%; float: left;">
                                    <strong>Driver:</strong>
                                    <p class="m-0" t-esc="doc.vehicle_id.driver_id.name"/>
                                </div>
                            </div>

                            <table style="margin-top: 52px; width: 100%;">
                                <thead>
                                    <tr style="height: 32px">
                                        <td style="padding-left: 10px;">Description</td>
                                        <td style="padding-left: 10px;">Qty</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-set="total_qty" t-value="1"/>
                                    <tr style="height: 32px" t-foreach="doc.item_ids" t-as="item">
                                        <td style="padding-left: 10px;"><span t-field="item.name"/></td>
                                        <td style="padding-left: 10px;"><span t-field="item.qty"/></td>
                                        <t t-set="total_qty" t-value="total_qty + item.qty"/>
                                    </tr>
                                    <!-- <tr style="height: 32px">
                                    <td style="padding-left: 10px;"></td>
                                    <td style="padding-left: 10px;border-top: 3px solid"><strong style="font-size: 14px; font-weight: bold;"><span t-esc="total_qty" /></strong></td>
                                </tr> -->
                            </tbody>
                        </table>

                        <div id="informations" class="row mt2 mb2" style="margin-top: 40px">

                            <div class="col-auto mw-100 mb-2" style="width: 50%; float: left;">
                                <strong>Printed by:</strong>
                                <p class="m-0" t-esc="user.name"/>
                            </div>

                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <report
        id="action_report_vehicle_statement"
        name="mgs_fleet_addons.vehicle_statement_wiz_report"
        file="mgs_fleet_addons.vehicle_statement_wiz_report"
        model="mgs_fleet_addons.vehicle_statement_wiz_report"
        string="Vehicle Statement"
        report_type="qweb-html"
        />

    <record id="action_report_vehicle_statement" model="ir.actions.report">
        <field name="name">Vehicle Statement</field>
        <field name="model">mgs_fleet_addons.vehicle_statement_wiz_report</field>
        <field name="report_type">qweb-html</field>
        <field name="report_name">mgs_fleet_addons.vehicle_statement_wiz_report</field>
        <field name="report_file">mgs_fleet_addons.vehicle_statement_wiz_report</field>
        <!-- <field name="attachment_use" eval="True" /> -->
    </record>

        <template id="vehicle_statement_wiz_report">
            <t t-call="web.html_container">
                    <t t-call="web.external_layout">
                        <div class="page" >
                            <h2 class="text-center">Vehicle Statement</h2>

                            <div id="informations" class="row mt2 mb2">
                                <div class="col-auto mw-100 mb-2" t-if="vehicle_id" style="width: 40%; float: left;">
                                    <strong>Vehicle:</strong>
                                    <p class="m-0" t-esc="vehicle_name"/>
                                </div>

                                <div class="col-auto mw-100 mb-2" t-if="date_from or date_to" style="width: 40%; float: left;">
                                    <strong>Date:</strong>
                                    <span class="m-0" t-esc="date_from" t-if="date_from"/>
                                    <span t-if="date_to"> - </span> <span class="m-0" t-esc="date_to" t-if="date_to"/>
                                </div>


                                <!--
                                <div class="col-auto mw-100 mb-2" t-if="vehicle_plate_no" name="due_date" style="width: 20%; float: left;" >
                                <strong>Plate No.:</strong>
                                <p class="m-0" t-esc="vehicle_plate_no"/>
                            </div> -->

                            <div class="col-auto mw-100 mb-2" t-if="vehicle_limit" style="width: 20%; float: left;">
                                <strong>Fuel Limit:</strong>
                                <span class="m-0" t-esc="vehicle_limit"/>
                            </div>
                        </div>

                        <table class="table table-bordered table-sm" style="margin-top: 6px;">
                            <thead style="font-weight: bold">
                                <tr>
                                    <td>Date</td>
                                    <td>Order#</td>
                                    <td class="text-right">Liter</td>
                                    <td class="text-right">Remaining</td>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="open_bal" t-value="0"/>

                                <tr t-if="date_from">
                                    <td colspan="3" class="text-right"><span>Consumed Balance Forward</span></td>
                                    <t t-set="open_bal" t-value="sum_consumed_fuel(date_from, vehicle_id)"/>
                                    <td style="text-align:right;font-weight:bold">
                                        <span t-esc="'{0:,.2f}'.format(open_bal)"/>
                                    </td>
                                </tr>
                                <tr t-foreach="lines(date_from, date_to, vehicle_id)" t-as="line">
                                    <td><span t-esc="line.date" /></td>
                                    <td><span t-esc="line.seq" /></td>
                                    <td class="text-right"><span t-esc="line.liter" /></td>
                                    <td class="text-right">
                                        <t t-set="open_bal" t-value="open_bal+line.liter"/>
                                        <span t-esc="open_bal" />
                                    </td>
                                </tr>
                                <tr style="background: #dfdddd; color: black !important">
                                    <td colspan="3"/>
                                    <td class="text-right" style="padding-left: 10px;border-top: 3px solid">
                                        <strong style="font-size: 14px; font-weight: bold;"><span t-esc="vehicle_limit-open_bal" /></strong>
                                    </td>
                                </tr>
                        </tbody>
                    </table>

                    <div id="informations" class="row mt2 mb2" style="margin-top: 40px">

                        <div class="col-auto mw-100 mb-2" style="width: 50%; float: left;">
                            <strong>Printed by:</strong>
                            <p class="m-0" t-esc="user.name"/>
                        </div>

                    </div>
                </div>
            </t>
    </t>
</template>

</odoo>
